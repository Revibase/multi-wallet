/**
 * This code was AUTOGENERATED using the Codama library.
 * Please DO NOT EDIT THIS FILE, instead use visitors
 * to add features, then rerun Codama to update it.
 *
 * @see https://github.com/codama-idl/codama
 */

import {
  combineCodec,
  fixDecoderSize,
  fixEncoderSize,
  getBytesDecoder,
  getBytesEncoder,
  getStructDecoder,
  getStructEncoder,
  getU16Decoder,
  getU16Encoder,
  getU32Decoder,
  getU32Encoder,
  getU64Decoder,
  getU64Encoder,
  getU8Decoder,
  getU8Encoder,
  type FixedSizeCodec,
  type FixedSizeDecoder,
  type FixedSizeEncoder,
  type ReadonlyUint8Array,
} from 'gill';
import {
  getRentConfigDecoder,
  getRentConfigEncoder,
  type RentConfig,
  type RentConfigArgs,
} from '.';

/** Compressible extension for ctoken accounts. */
export type CompressionInfo = {
  configAccountVersion: number;
  /** Compress to account pubkey instead of account owner. */
  compressToPubkey: number;
  /**
   * Version of the compressed token account when ctoken account is
   * compressed and closed. (The account_version specifies the hashing scheme.)
   */
  accountVersion: number;
  /**
   * Lamports amount the account is topped up with at every write
   * by the fee payer.
   */
  lamportsPerWrite: number;
  /** Authority that can compress and close the account. */
  compressionAuthority: ReadonlyUint8Array;
  /** Recipient for rent exemption lamports up on account closure. */
  rentSponsor: ReadonlyUint8Array;
  /** Last slot rent was claimed from this account. */
  lastClaimedSlot: bigint;
  /**
   * Rent exemption lamports paid at account creation.
   * Used instead of querying the Rent sysvar to ensure rent sponsor
   * gets back exactly what they paid regardless of future rent changes.
   */
  rentExemptionPaid: number;
  /** Reserved for future use. */
  reserved: number;
  /**
   * Rent function parameters,
   * used to calculate whether the account is compressible.
   */
  rentConfig: RentConfig;
};

export type CompressionInfoArgs = {
  configAccountVersion: number;
  /** Compress to account pubkey instead of account owner. */
  compressToPubkey: number;
  /**
   * Version of the compressed token account when ctoken account is
   * compressed and closed. (The account_version specifies the hashing scheme.)
   */
  accountVersion: number;
  /**
   * Lamports amount the account is topped up with at every write
   * by the fee payer.
   */
  lamportsPerWrite: number;
  /** Authority that can compress and close the account. */
  compressionAuthority: ReadonlyUint8Array;
  /** Recipient for rent exemption lamports up on account closure. */
  rentSponsor: ReadonlyUint8Array;
  /** Last slot rent was claimed from this account. */
  lastClaimedSlot: number | bigint;
  /**
   * Rent exemption lamports paid at account creation.
   * Used instead of querying the Rent sysvar to ensure rent sponsor
   * gets back exactly what they paid regardless of future rent changes.
   */
  rentExemptionPaid: number;
  /** Reserved for future use. */
  reserved: number;
  /**
   * Rent function parameters,
   * used to calculate whether the account is compressible.
   */
  rentConfig: RentConfigArgs;
};

export function getCompressionInfoEncoder(): FixedSizeEncoder<CompressionInfoArgs> {
  return getStructEncoder([
    ['configAccountVersion', getU16Encoder()],
    ['compressToPubkey', getU8Encoder()],
    ['accountVersion', getU8Encoder()],
    ['lamportsPerWrite', getU32Encoder()],
    ['compressionAuthority', fixEncoderSize(getBytesEncoder(), 32)],
    ['rentSponsor', fixEncoderSize(getBytesEncoder(), 32)],
    ['lastClaimedSlot', getU64Encoder()],
    ['rentExemptionPaid', getU32Encoder()],
    ['reserved', getU32Encoder()],
    ['rentConfig', getRentConfigEncoder()],
  ]);
}

export function getCompressionInfoDecoder(): FixedSizeDecoder<CompressionInfo> {
  return getStructDecoder([
    ['configAccountVersion', getU16Decoder()],
    ['compressToPubkey', getU8Decoder()],
    ['accountVersion', getU8Decoder()],
    ['lamportsPerWrite', getU32Decoder()],
    ['compressionAuthority', fixDecoderSize(getBytesDecoder(), 32)],
    ['rentSponsor', fixDecoderSize(getBytesDecoder(), 32)],
    ['lastClaimedSlot', getU64Decoder()],
    ['rentExemptionPaid', getU32Decoder()],
    ['reserved', getU32Decoder()],
    ['rentConfig', getRentConfigDecoder()],
  ]);
}

export function getCompressionInfoCodec(): FixedSizeCodec<
  CompressionInfoArgs,
  CompressionInfo
> {
  return combineCodec(getCompressionInfoEncoder(), getCompressionInfoDecoder());
}
